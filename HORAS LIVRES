WITH OCPD AS
(
	SELECT EXTRACT(DOW FROM R.DATA) DIA_SEMANA,
	       R.DATA,
	       R.HORA_INICIO ATEND_INI,
	       (R.HORA_INICIO + INTERVAL '1 MINUTES'*LP.TEMPO) ATEND_FIM,
	       R.LISTA_PRECO_ID,
	       R.PROFISSIONAL_ID,
	       R.ENTIDADE_ID
	FROM PROFISSIONAL_SERVICOS PS
	INNER JOIN RESERVAS R ON PS.LISTA_PRECO_ID = R.LISTA_PRECO_ID AND
				 PS.ENTIDADE_ID = R.ENTIDADE_ID
	INNER JOIN LISTA_PRECOS LP ON PS.LISTA_PRECO_ID = LP.ID
), LVR AS
(
	SELECT DIA_SEMANA,
	       (CASE DATE_PART('HOUR',HORA_FIM) WHEN 00 THEN '24:00:00' ELSE HORA_FIM END)- 
	       HORA_INICIO EXP_HORAS
	FROM HORARIOS
)
SELECT * FROM LVR
ORDER BY DIA_SEMANA, EXP_HORAS